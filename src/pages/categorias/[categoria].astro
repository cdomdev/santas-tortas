---
import "@/styles/globals.css";
import { contenido } from "@/content";
import Layout from "@/layouts/Layout.astro";
import type { Producto } from "@/types";
import { getCategorieBy, getCategories } from "@/lib/getCategories";
import ViewProducts from "@/components/ViewProducts.astro";
import Crumbs from "@/components/Crumbs.astro";

export const prerender = true;
interface Category {
  id: Number;
  documentId: string;
  name: string;
}

export async function getStaticPaths() {
  try {
    const categories = await getCategories();

    if (!categories || !Array.isArray(categories.data)) {
      return [];
    }

    return categories.data.map((category: Category) => ({
      params: { categoria: category.name.toLowerCase() },
    }));
  } catch (error) {
    console.error("Error en getStaticPaths:", error);
    return [];
  }
}

const { categoria } = Astro.params;

const response = await getCategorieBy(categoria);
const products: Producto[] = response?.data ?? [];

const contenidoPages = contenido.find((c) => c.categoria === categoria);
---

<Layout title={categoria}>
  <Crumbs pagina={["productos", categoria]} />
  <section class="max-w-screen-xl mx-auto pt-5">
    <h1
      class="text-xl md:text-3xl text-center text-[#f1683a] font-bold -mb-1"
      id="title"
    >
      {contenidoPages?.titulo}
    </h1>
    <p
      class="mb-3 text-center text-xs md:text-sm text-[#5f3b3c] font-extrabold"
      id="des"
    >
      Â¡Perfect{contenidoPages?.l}s para compartir o disfrutar solo!
    </p>
    <p class="text-xs md:text-base my-3 text-balance px-3 md:px-o" id="des">
      {contenidoPages?.texto}
    </p>

    <div class="h-auto w-full flex my-8 items-center justify-end" id="des">
    </div>
  </section>
  <section class="flex gap-2 max-w-screen-xl mx-auto">
    <aside
      id="cards-categorias"
      class="w-full max-w-[20%] hidden md:flex flex-col px-4 py-5 gap-y-3"
    >
      <h2 class="font-bold text-base md:text-xl border-b pl-2">Precios</h2>
      <ol class="font-normal text-sm/10 border h-auto py-4 px-2">
        <li>
          <input type="checkbox" class="mr-2 rounded-full" />Todos los productos
        </li>
        <li>
          <input type="checkbox" class="mr-2 rounded-full" />Mayor a menor
        </li>
        <li>
          <input type="checkbox" class="mr-2 rounded-full" />Menor a mayor
        </li>
      </ol>
    </aside>
    <article class="w-full">
      <ViewProducts products={products} />
    </article>
  </section>
</Layout>

<style>
  #cards-categorias {
    opacity: 0;
    animation: showContent 0.5s 1s linear 1 forwards;
  }

  #cards-categorias {
    transform: translatex(-50px);
    filter: blur(5px);
  }

  @keyframes showContent {
    to {
      transform: translateY(0px);
      filter: blur(0px);
      opacity: 1;
    }
  }

  #cards-categorias {
    animation-delay: 2.5s;
  }
</style>
